name: Agents Tasks → Issues

on:
  workflow_dispatch:
    inputs:
      section:
        description: "Sekcja do zaczytania (np. 'Priorytet wysoki'; puste = wszystkie)"
        required: false

permissions:
  contents: read
  issues: write

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Parse tasks and create issues
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const wanted = core.getInput('section') || '';
            const raw = fs.readFileSync('agents-tasks.md','utf8');
            // jeśli podano sekcję, ogranicz zakres
            let scope = raw;
            if (wanted.trim()) {
              const parts = raw.split(/^##\s+/m);
              const sec = parts.find(p => p.trim().startsWith(wanted.trim()));
              if (sec) scope = sec;
            }
            const lines = scope.split(/\r?\n/).filter(l => l.trim().startsWith('- [ ]'));
            if (!lines.length) {
              core.notice('No unchecked tasks found in scope.');
              return;
            }
            for (const line of lines) {
              const title = line.replace(/^- \[ \] /,'').trim();
              core.info(`Creating issue: ${title}`);
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title,
                labels: ['agent-task','todo'],
                body: 'Automatycznie utworzone z agents-tasks.md'
              });
            }
            core.summary.addHeading('Created issues').addList(lines).write();
